---

## Title: tasks/arr/gluetun.yml
## Description: Deploy gluetun in a docker container
## Author: Joseph Harry <findarato@gmail.com>
## Copyright: Joseph Harry <findarato@gmail.com>
## Date: 2025-10-26 15:35:12
##
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## You should have received a copy of the GNU General Public License along
## with this program; if not, write to the Free Software Foundation, Inc.
## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.


#      ‚ñÑ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñì     ‚ñà    ‚ñà‚ñà ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì ‚ñà    ‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñÑ    ‚ñà 
#     ‚ñà‚ñà‚ñí ‚ñÄ‚ñà‚ñí‚ñì‚ñà‚ñà‚ñí     ‚ñà‚ñà  ‚ñì‚ñà‚ñà‚ñí‚ñì‚ñà   ‚ñÄ‚ñì  ‚ñà‚ñà‚ñí ‚ñì‚ñí ‚ñà‚ñà  ‚ñì‚ñà‚ñà‚ñí ‚ñà‚ñà ‚ñÄ‚ñà   ‚ñà 
#    ‚ñí‚ñà‚ñà‚ñë‚ñÑ‚ñÑ‚ñÑ‚ñë‚ñí‚ñà‚ñà‚ñë    ‚ñì‚ñà‚ñà  ‚ñí‚ñà‚ñà‚ñë‚ñí‚ñà‚ñà‚ñà  ‚ñí ‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñë‚ñì‚ñà‚ñà  ‚ñí‚ñà‚ñà‚ñë‚ñì‚ñà‚ñà  ‚ñÄ‚ñà ‚ñà‚ñà‚ñí
#    ‚ñë‚ñì‚ñà  ‚ñà‚ñà‚ñì‚ñí‚ñà‚ñà‚ñë    ‚ñì‚ñì‚ñà  ‚ñë‚ñà‚ñà‚ñë‚ñí‚ñì‚ñà  ‚ñÑ‚ñë ‚ñì‚ñà‚ñà‚ñì ‚ñë ‚ñì‚ñì‚ñà  ‚ñë‚ñà‚ñà‚ñë‚ñì‚ñà‚ñà‚ñí  ‚ñê‚ñå‚ñà‚ñà‚ñí
#    ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñà‚ñÄ‚ñí‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí ‚ñí‚ñà‚ñà‚ñí ‚ñë ‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì ‚ñí‚ñà‚ñà‚ñë   ‚ñì‚ñà‚ñà‚ñë
#     ‚ñë‚ñí   ‚ñí ‚ñë ‚ñí‚ñë‚ñì  ‚ñë‚ñë‚ñí‚ñì‚ñí ‚ñí ‚ñí ‚ñë‚ñë ‚ñí‚ñë ‚ñë ‚ñí ‚ñë‚ñë   ‚ñë‚ñí‚ñì‚ñí ‚ñí ‚ñí ‚ñë ‚ñí‚ñë   ‚ñí ‚ñí 
#      ‚ñë   ‚ñë ‚ñë ‚ñë ‚ñí  ‚ñë‚ñë‚ñë‚ñí‚ñë ‚ñë ‚ñë  ‚ñë ‚ñë  ‚ñë   ‚ñë    ‚ñë‚ñë‚ñí‚ñë ‚ñë ‚ñë ‚ñë ‚ñë‚ñë   ‚ñë ‚ñí‚ñë
#    ‚ñë ‚ñë   ‚ñë   ‚ñë ‚ñë    ‚ñë‚ñë‚ñë ‚ñë ‚ñë    ‚ñë    ‚ñë       ‚ñë‚ñë‚ñë ‚ñë ‚ñë    ‚ñë   ‚ñë ‚ñë 
#          ‚ñë     ‚ñë  ‚ñë   ‚ñë        ‚ñë  ‚ñë           ‚ñë              ‚ñë 

# - name: Create Docker paths
#   file:
#     path: "{{ docker_gluetun_storage }}{{ item }}"
#     state: directory
#   with_items:
#     - config
#   tags:
#     - gluetun
#     - arr

- name: üè¥‚Äç‚ò†Ô∏è Create and Update gluetun Container
  community.docker.docker_container:
    name: gluetun
    image: "qmcgaw/gluetun:{{ gluetun_release}}"
    hostname: gluetun 
    state: started
    restart_policy: "{{ docker_restart_condition }}"
    env:
      TZ: America/Chicago
      VPN_SERVICE_PROVIDER: mullvad
      VPN_TYPE: wireguard
      WIREGUARD_PRIVATE_KEY: "{{ gluetun_private_key }}"
      WIREGUARD_ADDRESSES: "{{ gluetun_addresses }}"
      SERVER_COUNTRIES: "{{ gluetun_countries }}"
      SERVER_CITIES: "{{ gluetun_cities }}"
      HEALTH_RESTART_VPN: "on"
      HEALTH_ICMP_TARGET_IPS: "1.1.1.1,8.8.8.8"
      HEALTH_TARGET_ADDRESSES: "cloudflare.com:443,github.com:443"
    volumes:
      # - "{{ docker_gluetun_storage }}/config:/gluetun"
      - /etc/localtime:/ect/localtime:ro
      - /dev/net/tun:/dev/net/tun
    # networks:
    #   - name: "{{ traefik_proxy_network }}" # Connect to traefik for routing
    #     gw_priority: 10
    labels:
      traefik.enable: "true"
      traefik.http.routers.deluge.rule: Host(`{{ deluge_app_name }}.{{ traefik_domain }}`)
      traefik.http.routers.deluge.tls: "true"
      traefik.http.routers.deluge.entrypoints: websecure
      traefik.http.services.deluge.loadbalancer.server.port: "8112"
      traefik.tcp.services.deluge-tcp.loadbalancer.server.port: "58846"
    capabilities: 
      - NET_ADMIN
  tags:
    - gluetun
    - arr
    - vpn